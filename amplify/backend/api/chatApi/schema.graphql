type ChatRoom @model {
  id: ID!
  initiatorId: ID!
  initiatorUsername: String!
  subscriberId: ID!
  subscriberUsername: String!
  lastMessage: String
  lastMessageAuthorId: ID
  messages: [Message] @connection(keyName: "chatMessages", fields: ["id"])
}

type Message
@model
@key(name: "byChatId", fields: ["chatId", "createdAt"], queryField: "messagesByChatId")
@key(name: "chatMessages", fields: ["chatId"])
{
  id: ID!
  chatId: ID!
  authorId: ID!
  body: String!
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type User @model {
  id: ID!
  email: String!
  username: String!
}

type Subscription {
  onMessageByChatId(chatId: ID!): Message
    @aws_subscribe(mutations: ["createMessage"])

  onCreateChatRoomBySubscriberId(subscriberId: ID!): ChatRoom
    @aws_subscribe(mutations: ["createChatRoom"])

  onUpdateChatRoomById(id: ID!): ChatRoom
    @aws_subscribe(mutations: ["updateChatRoom"])
}
